http://sourceware.org/ml/binutils/2007-08/msg00411.html

forcing CFLAGS against C++ builds causes false failures

---
 ld/testsuite/lib/ld-lib.exp |    7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

Index: binutils-2.20/ld/testsuite/lib/ld-lib.exp
===================================================================
--- binutils-2.20.orig/ld/testsuite/lib/ld-lib.exp	2009-11-19 13:15:47.000000000 +0100
+++ binutils-2.20/ld/testsuite/lib/ld-lib.exp	2009-11-19 13:17:36.000000000 +0100
@@ -225,7 +225,11 @@
     remote_file build delete "$object"
     remote_file host delete "$object"
 
-    set flags "-I$srcdir/$subdir"
+    if {[string match "*.cc" $source]} then {
+ 	set flags "-I$srcdir/$subdir $CXXFLAGS"
+    } else {
+ 	set flags "-I$srcdir/$subdir $CFLAGS"
+    }
 
     # If we are compiling with gcc, we want to add gcc_gas_flag to
     # flags.  Rather than determine this in some complex way, we guess
@@ -1175,6 +1179,7 @@
     global env
     global CC
     global CFLAGS
+    global CXXFLAGS
     global runtests
 
     foreach testitem $ldtests {
